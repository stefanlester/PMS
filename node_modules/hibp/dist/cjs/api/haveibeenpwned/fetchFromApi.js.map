{"version":3,"file":"fetchFromApi.js","sources":["../../../../src/api/haveibeenpwned/fetchFromApi.ts"],"sourcesContent":["import fetch from 'isomorphic-unfetch';\nimport { name, version } from '../../../package.json';\nimport { ApiData, ErrorData } from './types';\nimport {\n  BAD_REQUEST,\n  UNAUTHORIZED,\n  FORBIDDEN,\n  NOT_FOUND,\n  TOO_MANY_REQUESTS,\n} from './responses';\n\nfunction blockedWithRayId(rayId: string) {\n  return `Request blocked, contact haveibeenpwned.com if this continues (Ray ID: ${rayId})`;\n}\n\n/**\n * Fetches data from the supplied API endpoint.\n *\n * HTTP status code 200 returns an Object (data found).\n * HTTP status code 404 returns null (no data found).\n * HTTP status code 400 throws an Error (bad request).\n * HTTP status code 401 throws an Error (unauthorized).\n * HTTP status code 403 throws an Error (forbidden).\n * HTTP status code 429 throws an Error (too many requests).\n *\n * @internal\n * @private\n * @param {string} endpoint the API endpoint to query\n * @param {object} [options] a configuration object\n * @param {string} [options.apiKey] an API key from\n * https://haveibeenpwned.com/API/Key\n * @param {string} [options.baseUrl] a custom base URL for the\n * haveibeenpwned.com API endpoints (default:\n * `https://haveibeenpwned.com/api/v3`)\n * @param {string} [options.userAgent] a custom string to send as the User-Agent\n * field in the request headers (default: `hibp <version>`)\n * @returns {Promise<ApiData>} a Promise which resolves to the data resulting\n * from the query (or null for 404 Not Found responses), or rejects with an\n * Error\n */\nexport function fetchFromApi(\n  endpoint: string,\n  /* istanbul ignore next: no need to test default empty object */\n  {\n    apiKey,\n    baseUrl = 'https://haveibeenpwned.com/api/v3',\n    userAgent,\n  }: { apiKey?: string; baseUrl?: string; userAgent?: string } = {},\n): Promise<ApiData> {\n  const headers: Record<string, string> = {};\n\n  if (apiKey) {\n    headers['HIBP-API-Key'] = apiKey;\n  }\n\n  if (userAgent) {\n    headers['User-Agent'] = userAgent;\n  }\n\n  // Provide a default User-Agent when running outside the browser\n  if (!userAgent && typeof navigator === 'undefined') {\n    headers['User-Agent'] = `${name} ${version}`;\n  }\n\n  const config = { headers };\n  const url = `${baseUrl.replace(/\\/$/g, '')}${endpoint}`;\n\n  return fetch(url, config).then((res) => {\n    if (res.ok) return res.json();\n\n    switch (res.status) {\n      case BAD_REQUEST.status:\n        throw new Error(BAD_REQUEST.statusText);\n      case UNAUTHORIZED.status:\n        return res.json().then((body: ErrorData) => {\n          throw new Error(body.message);\n        });\n      case FORBIDDEN.status: {\n        const rayId = res.headers.get('cf-ray');\n        if (rayId) {\n          throw new Error(blockedWithRayId(rayId));\n        }\n        throw new Error(FORBIDDEN.statusText);\n      }\n      case NOT_FOUND.status:\n        return null;\n      case TOO_MANY_REQUESTS.status:\n        return res.json().then((body: ErrorData) => {\n          throw new Error(body.message);\n        });\n      default:\n        throw new Error(res.statusText);\n    }\n  });\n}\n"],"names":["blockedWithRayId","rayId","fetchFromApi","endpoint","apiKey","baseUrl","userAgent","headers","navigator","name","version","config","url","replace","fetch","then","res","ok","json","status","BAD_REQUEST","Error","statusText","UNAUTHORIZED","body","message","FORBIDDEN","get","NOT_FOUND","TOO_MANY_REQUESTS"],"mappings":";;;;;;;;;;;;AAWA,SAASA,gBAAT,CAA0BC,KAA1B;AACE,0FAAiFA,KAAjF;AACD;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;SAyBgBC,aACdC;iFAM+D;MAH7DC,cAAAA;0BACAC;MAAAA,oCAAU;MACVC,iBAAAA;;AAGF,MAAMC,OAAO,GAA2B,EAAxC;;AAEA,MAAIH,MAAJ,EAAY;AACVG,IAAAA,OAAO,CAAC,cAAD,CAAP,GAA0BH,MAA1B;AACD;;AAED,MAAIE,SAAJ,EAAe;AACbC,IAAAA,OAAO,CAAC,YAAD,CAAP,GAAwBD,SAAxB;AACD;;;AAGD,MAAI,CAACA,SAAD,IAAc,OAAOE,SAAP,KAAqB,WAAvC,EAAoD;AAClDD,IAAAA,OAAO,CAAC,YAAD,CAAP,aAA2BE,aAA3B,cAAmCC,gBAAnC;AACD;;AAED,MAAMC,MAAM,GAAG;AAAEJ,IAAAA,OAAO,EAAPA;AAAF,GAAf;AACA,MAAMK,GAAG,aAAMP,OAAO,CAACQ,OAAR,CAAgB,MAAhB,EAAwB,EAAxB,CAAN,SAAoCV,QAApC,CAAT;AAEA,SAAOW,yBAAK,CAACF,GAAD,EAAMD,MAAN,CAAL,CAAmBI,IAAnB,CAAwB,UAACC,GAAD;AAC7B,QAAIA,GAAG,CAACC,EAAR,EAAY,OAAOD,GAAG,CAACE,IAAJ,EAAP;;AAEZ,YAAQF,GAAG,CAACG,MAAZ;AACE,WAAKC,qBAAW,CAACD,MAAjB;AACE,cAAM,IAAIE,KAAJ,CAAUD,qBAAW,CAACE,UAAtB,CAAN;;AACF,WAAKC,sBAAY,CAACJ,MAAlB;AACE,eAAOH,GAAG,CAACE,IAAJ,GAAWH,IAAX,CAAgB,UAACS,IAAD;AACrB,gBAAM,IAAIH,KAAJ,CAAUG,IAAI,CAACC,OAAf,CAAN;AACD,SAFM,CAAP;;AAGF,WAAKC,mBAAS,CAACP,MAAf;AAAuB;AACrB,cAAMlB,KAAK,GAAGe,GAAG,CAACT,OAAJ,CAAYoB,GAAZ,CAAgB,QAAhB,CAAd;;AACA,cAAI1B,KAAJ,EAAW;AACT,kBAAM,IAAIoB,KAAJ,CAAUrB,gBAAgB,CAACC,KAAD,CAA1B,CAAN;AACD;;AACD,gBAAM,IAAIoB,KAAJ,CAAUK,mBAAS,CAACJ,UAApB,CAAN;AACD;;AACD,WAAKM,mBAAS,CAACT,MAAf;AACE,eAAO,IAAP;;AACF,WAAKU,2BAAiB,CAACV,MAAvB;AACE,eAAOH,GAAG,CAACE,IAAJ,GAAWH,IAAX,CAAgB,UAACS,IAAD;AACrB,gBAAM,IAAIH,KAAJ,CAAUG,IAAI,CAACC,OAAf,CAAN;AACD,SAFM,CAAP;;AAGF;AACE,cAAM,IAAIJ,KAAJ,CAAUL,GAAG,CAACM,UAAd,CAAN;AArBJ;AAuBD,GA1BM,CAAP;AA2BD;;;;"}